# TaleArc 开发计划

> AI 辅助小说创作与世界观管理系统 | 全栈开发计划

---

## 设计理念

### 核心定位
**可独立使用的世界观规划工具 + AI 增强的创作助手**

即使不使用 AI 功能，TaleArc 也是一个完整的世界观架构与小说规划工具。AI 是辅助，不是依赖。

### 设计原则

#### 1. 结构化创作思维
- **自顶向下**：从世界观到角色、事件、杂项，层次清晰
- **时间维度**：角色快照记录成长，事件串联因果，时间线自动生成可视化逻辑
- **引用机制**：文章可引用角色、事件、杂项作为创作上下文

#### 2. 灵活的 AI 协作模式
- **普通创作**：基于上下文的快速生成，适合连续写作
- **大纲驱动**：先规划后执行，支持并行生成+自动融合，适合长篇结构化创作
- **管道定制**：节点图编排创作流程，适合重复性工作流和复杂逻辑

#### 3. 上下文即权力
用户可精准控制 AI 的输入：
- 选择前文章节（使用 AI 总结或手写摘要）
- 引用相关概念（角色、事件、杂项）
- 指定写手风格
- 随时介入修正（选中段落提出修改需求）

#### 4. 可迁移与开放
- **导入解析**：AI 自动识别外部书籍的角色、事件、世界观，降低迁移成本
- **数据互通**：实体级导入导出，支持多环境同步
- **格式自由**：小说可导出为 TXT/EPUB/PDF/Markdown
- **扩展友好**：预留 RAGFlow、LangGraph、MCP 等工具集成接口

### 核心场景

#### 场景 1：规划优先的作者
1. 创建世界观，定义核心设定（文化、武器等杂项）
2. 设计主要角色，在不同时期创建快照
3. 规划关键事件，关联涉及的角色
4. 在时间线上梳理因果关系
5. 开始创作时，AI 可基于完整上下文提供建议

#### 场景 2：边写边构建的作者
1. 直接开始写作，使用 AI 快速生成初稿
2. 遇到矛盾时，补充世界观设定和角色信息
3. 后期通过时间线整理已写内容的逻辑
4. 导出实体数据，在其他设备继续完善

#### 场景 3：续写外部作品
1. 导入原著小说文件
2. AI 自动解析角色、事件、世界观
3. 人工审核修正 AI 解析结果
4. 基于原著设定开始续写

---

## 核心概念架构

```
世界观 (WorldView)
├── 角色 (Character) → 角色快照 (CharacterSnapshot)
├── 事件 (WorldEvent)
├── 杂项 (Misc)
├── 小说 (Novel) → 引用角色/事件/杂项
└── 时间线 (Timeline) - 实时计算生成

顶层配置
├── 写手 (Writer) - API配置与风格
└── 管道 (Pipeline) - 自定义创作流程
```

---

## v0.1 ✅ 已完成
- 基础后端结构
- PostgreSQL 连接
- API 请求响应

## v0.2 ✅ 已完成
- 用户认证系统（注册/登录/JWT）
- 密码加密（PBKDF2）
- 注册密钥机制

---

## v0.3 - 核心数据模型（当前目标）

### 后端任务
- [ ] 完善 WorldView 实体与 CRUD API
- [ ] 完善 Character 实体与 CRUD API
- [ ] 完善 CharacterSnapshot 实体与 CRUD API
- [ ] 完善 WorldEvent 实体与 CRUD API
- [ ] 完善 Misc 实体与 CRUD API
- [x] 添加 Novel 实体与 CRUD API
- [ ] 文章引用关系设计（引用角色/事件/杂项）
- [ ] 实体间关联关系验证
- [ ] 数据迁移脚本

### 前端任务
- [ ] 项目初始化（React/Vue + Vite）
- [ ] 路由与布局框架
- [ ] 登录/注册页面
- [ ] 世界观列表与创建
- [ ] 角色/事件/杂项管理界面
- [ ] 基础数据展示与编辑表单

---

## v0.4 - 时间线功能

### 后端任务
- [ ] 时间线实时计算 API（基于角色、事件动态生成）
- [ ] 角色线与事件节点的时间轴算法
- [ ] 时间线数据聚合接口（无数据库存储）

### 前端任务
- [ ] 时间线可视化组件（SVG/Canvas）
- [ ] 角色线与事件块渲染
- [ ] 拖拽调整事件时间
- [ ] 时间线交互（缩放、筛选）

---

## v0.5 - 写手管理

### 后端任务
- [ ] Writer 实体（API配置、风格描述）
- [ ] 加密存储 API Key
- [ ] 写手 CRUD API
- [ ] AI 调用统一接口封装

### 前端任务
- [ ] 写手配置页面
- [ ] API 密钥安全输入
- [ ] 写手风格编辑器
- [ ] 写手列表与选择

---

## v0.6 - 基础 AI 写作

### 后端任务
- [ ] AI 调用服务（OpenAI/Claude/自定义）
- [ ] 上下文构建（章节摘要、角色/事件引用）
- [ ] 生成结果保存与版本管理
- [ ] 流式响应支持（SSE/WebSocket）

### 前端任务
- [ ] 富文本编辑器集成
- [ ] 章节选择器（前文引用）
- [ ] 概念引用面板（角色/事件/杂项）
- [ ] AI 生成界面与实时展示
- [ ] 段落重写功能（选中文本+修改需求）

---

## v0.7 - 大纲式创作

### 后端任务
- [ ] 大纲结构存储（树形/列表）
- [ ] 并行生成任务调度
- [ ] 段落融合优化算法
- [ ] 大纲校验与自动重写

### 前端任务
- [ ] 大纲编辑器（拖拽排序）
- [ ] 串行/并行模式选择
- [ ] 生成进度监控
- [ ] 校验结果展示与修正

---

## v0.8 - 管道编辑器

### 后端任务
- [ ] Pipeline 实体与节点定义
- [ ] 节点执行引擎（顺序/条件/并行）
- [ ] 内置节点类型（生成/总结/校验/优化）
- [ ] 管道执行日志与调试

### 前端任务
- [ ] 可视化节点图编辑器（类似 n8n/LangGraph）
- [ ] 节点拖拽与连线
- [ ] 节点参数配置面板
- [ ] 管道执行与结果查看

---

## v0.9 - 导入解析

### 后端任务
- [ ] 文件上传接口（TXT/EPUB/PDF）
- [ ] AI 自动解析（章节分割、角色提取、事件识别）
- [ ] 解析结果审核接口
- [ ] 批量创建实体

### 前端任务
- [ ] 文件上传界面
- [ ] 解析进度展示
- [ ] 解析结果预览与编辑
- [ ] 一键导入确认

---

## v1.0 - 导入导出

### 后端任务
- [ ] 实体数据导出（JSON/ZIP）
- [ ] 导入数据校验与合并
- [ ] 小说导出（TXT/EPUB/PDF/Markdown）
- [ ] 模板引擎（封面、目录、格式化）

### 前端任务
- [ ] 导出选项配置（选择实体、格式）
- [ ] 导入文件解析与冲突处理
- [ ] 小说导出格式选择
- [ ] 下载进度与预览

---

## v1.1+ - 高级功能（待规划）

- [ ] RAGFlow 集成（知识库检索）
- [ ] LangGraph 工作流增强
- [ ] MCP (Model Context Protocol) 支持
- [ ] 多人协作（权限、冲突）
- [ ] 版本历史与回滚
- [ ] AI 自动摘要与标签

---

## 技术栈

### 后端
- .NET 8 + ASP.NET Core
- PostgreSQL + EF Core
- JWT 认证
- Serilog 日志
- SignalR/SSE（实时通信）

### 前端
- React/Vue 3 + TypeScript
- Vite
- UnoCSS（原子化 CSS）
- 富文本：Tiptap / Quill
- 节点图：ReactFlow / Vue Flow
- 时间线：D3.js / 自定义 Canvas

### AI 集成
- OpenAI API
- Anthropic Claude
- 自定义模型（Ollama/LM Studio）
- LangChain（可选）